<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <title>Document</title>
</head>
<body>
    <h1></h1>
    <div class="container my-5">
        <div class="text-center">
          <h1 class="display-4 text-center mb-3">Axios Crash Course</h1>
          <button class="btn btn-primary my-3" id="get">GET</button>
          <button class="btn btn-info" id="post">POST</button>
          <button class="btn btn-warning" id="update">PUT/PATCH</button>
          <button class="btn btn-danger" id="delete">DELETE</button>
          <button class="btn btn-secondary" id="sim">Sim Requests</button>
          <button class="btn btn-secondary" id="headers">
            Custom Headers
          </button>
          <button class="btn btn-secondary" id="transform">
            Transform
          </button>
          <button class="btn btn-secondary" id="error">
            Error Handling
          </button>
          <button class="btn btn-secondary" id="cancel">
            Cancel
          </button>
        </div>
        <hr />
        <div id="res"></div>
      </div>
  
      <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
      <script>
        //Axios Global
axios.defaults.headers.common['X-Auth-Token'] =
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';


function getTodos() {
    //console.log('GET Request');
  //   axios({
  //     method:'get',
  //     url: 'https://jsonplaceholder.typicode.com/todos',
  //     params: {
  //       _limit: 5
  //     }
  //   })
  //   .then(res=>showOutput(res))
  //   .catch(err=>console.error(err));
  // }
  
  axios ('https://jsonplaceholder.typicode.com/todos?_limit=5')
  .then(res=>showOutput(res))
    .catch(err=>console.error(err));
}
  // POST REQUEST
  function addTodo() {
    console.log('POST Request');
    axios 
    .post('https://jsonplaceholder.typicode.com/todos', {
      title:'newTodo',
      completed:false
    })
        .then(res=>showOutput(res))
        .catch(err=>console.error(err));
  }
  
  // PUT/PATCH REQUEST
  function updateTodo() {
    console.log('PUT/PATCH Request');
    axios 
    .patch('https://jsonplaceholder.typicode.com/todos/1', {
      title:'update Todo',
      completed:true
    })
        .then(res=>showOutput(res))
        .catch(err=>console.error(err));
  }
  
  // DELETE REQUEST
  function removeTodo() {
    console.log('DELETE Request');
    axios 
    .delete('https://jsonplaceholder.typicode.com/todos/1',)
        .then(res=>showOutput(res))
        .catch(err=>console.error(err));
  }
  
  // SIMULTANEOUS DATA
  function getData() {
    console.log('Simultaneous Request');
    axios.all([
      axios.get('https://jsonplaceholder.typicode.com/todos?_limit=2'),
      axios.get('https://jsonplaceholder.typicode.com/posts?_limit=2')
    ])
      .then(axios.spread((todos,posts)=>showOutput(posts)))
      .catch(err=>console.error(err));
  }
  
  // CUSTOM HEADERS
  function customHeaders() {
    console.log('Custom Headers');
    const config = {
      headers: {
        'content-type':'application/json',
        Authrization:'sometoken'
      }
    }
    axios 
    .post('https://jsonplaceholder.typicode.com/todos', {
      title:'newTodo',
      completed:false
    },config)
        .then(res=>showOutput(res))
        .catch(err=>console.error(err));
  }
  
  // TRANSFORMING REQUESTS & RESPONSES
  function transformResponse() {
    console.log('Transform Response');
    const options = {
     method:'post',
     url:'https://jsonplaceholder.typicode.com/todos',
     data:{
      title:'hello world'
     },
     transformResponse:axios.defaults.transformResponse.concat(data=>{
      data.title=data.title.toUpperCase()
      return data
     })
    }
    axios(options).then(res=>showOutput(res))
  }
  
  // ERROR HANDLING
  function errorHandling() {
    console.log('Error Handling');
    axios 
    .get('https://jsonplaceholder.typicode.com/todoss')
  .then(res=>showOutput(res))
    .catch(err =>{
      if (err.response){
        // server responded with error other than 200
         console.log(err.response.data)
         console.log(err.response.status)
         console.log(err.response.headers)
      
         if (err.response.status === 404) {
          alert('Error: Page Not Found');
        }
       else if (err.request) {
        // Request was made but no response
        console.error(err.request);
      } else {
        console.error(err.message);
      }

      }
    })
  }
  
  // CANCEL TOKEN
  function cancelToken() {
    console.log('Cancel Token');
  }
  
  // INTERCEPTING REQUESTS & RESPONSES
  axios.interceptors.request.use(
    config =>{
    console.log(`${config.method.toUpperCase()} request sent to ${config.url} at ${new Date().getTime()}`);
  
  return config;
  },error=>{
    return Promise.reject(error);
  }
  )
  
  // AXIOS INSTANCES
  
  // Show output in browser
  function showOutput(res) {
    document.getElementById('res').innerHTML = `
    <div class="card card-body mb-4">
      <h5>Status: ${res.status}</h5>
    </div>
    <div class="card mt-3">
      <div class="card-header">
        Headers
      </div>
      <div class="card-body">
        <pre>${JSON.stringify(res.headers, null, 2)}</pre>
      </div>
    </div>
    <div class="card mt-3">
      <div class="card-header">
        Data
      </div>
      <div class="card-body">
        <pre>${JSON.stringify(res.data, null, 2)}</pre>
      </div>
    </div>
    <div class="card mt-3">
      <div class="card-header">
        Config
      </div>
      <div class="card-body">
        <pre>${JSON.stringify(res.config, null, 2)}</pre>
      </div>
    </div>
  `;
  }
  
  // Event listeners
  document.getElementById('get').addEventListener('click', getTodos);
  document.getElementById('post').addEventListener('click', addTodo);
  document.getElementById('update').addEventListener('click', updateTodo);
  document.getElementById('delete').addEventListener('click', removeTodo);
  document.getElementById('sim').addEventListener('click', getData);
  document.getElementById('headers').addEventListener('click', customHeaders);
  document
    .getElementById('transform')
    .addEventListener('click', transformResponse);
  document.getElementById('error').addEventListener('click', errorHandling);
  document.getElementById('cancel').addEventListener('click', cancelToken);
      </script>
    
</body>
</html>